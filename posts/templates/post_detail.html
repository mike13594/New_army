<!DOCTYPE html>
<html lang="ko">
<body>
    <h1>{{ post.title }}</h1>
    <p>작성자: {{ post.user.id }} | 작성일: {{ post.created }}</p>
    <hr>
    <p>{{ post.content }}</p>

    <h3>여행 장소</h3>
<ul>
    {% for place in places %}
        <li>
            <a href="{% url 'place_detail' place.id %}">{{ place.name }}</a>

            {% if place.id in completed_places_list %}
                <span>(완료됨)</span>
                {% if user.is_authenticated %}
                    <a href="{% url 'place_uncomplete' post.id place.id %}" class="btn btn-warning btn-sm">완료 해제</a>
                {% endif %}
            {% else %}
                {% if user.is_authenticated %}
                    <a href="{% url 'place_complete' post.id place.id %}" class="btn btn-success btn-sm">완료</a>
                {% else %}
                    <p><a href="{% url 'login' %}">로그인</a> 후 완료할 수 있습니다.</p>
                {% endif %}
            {% endif %}
        </li>
    {% endfor %}
</ul>

    <h3>댓글</h3>
    <ul>
        {% for comment in comments %}
        <li>
            <strong>{{ comment.user.id }}</strong> ({{ comment.created}})
            <p>{{ comment.content }}</p>
            {% if user == comment.user %}
            <form method="POST" action="{% url 'comment_delete' comment.id %}">
                {% csrf_token %}
                <button type="submit">댓글 삭제</button>
            </form>
            {% endif %}
        </li>
        {% endfor %}
    </ul>

         {% if user.is_authenticated %}
            <h4>댓글 작성</h4>
            <form method="POST" action="{% url 'comment_add' post.id %}">
            {% csrf_token %}
            {{ comment_form.as_p }}
                <button type="submit">댓글 등록</button>
            </form>
        {% else %}
            <p><a href="{% url 'login' %}">로그인</a> 후 댓글을 작성할 수 있습니다.</p><!-- 로그인 기능 검사해야함-->
        {% endif %}

    {% if user == post.user %}
        <hr>
        <a href="{% url 'post_edit' post.id %}">글 수정</a>
        <a href="{% url 'post_delete' post.id %}">글 삭제</a>
    {% endif %}
    
    <hr>
    <a href="{% url 'main' %}">홈으로 돌아가기</a>
</body>
</html>